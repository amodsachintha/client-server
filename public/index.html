<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="semantic/semantic.min.css">
    <script src="semantic/jquery-3.4.1.min.js"></script>
    <script src="semantic/semantic.min.js"></script>
    <script src="semantic/axios.min.js"></script>
    <title>Title</title>
</head>
<body style="margin-top: 4em">
<h2 class="ui centered header">Devices</h2>
<div class="ui container" style="margin-top: 3em;">
    <div class="ui grid">
        <div class="column">
            <div id="placeholder" class="ui three column stackable grid">
                <div class="column">
                    <div class="ui raised segment">
                        <div class="ui placeholder">
                            <div class="image header">
                                <div class="line"></div>
                                <div class="line"></div>
                            </div>
                            <div class="paragraph">
                                <div class="medium line"></div>
                                <div class="short line"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="column">
                    <div class="ui raised segment">
                        <div class="ui placeholder">
                            <div class="image header">
                                <div class="line"></div>
                                <div class="line"></div>
                            </div>
                            <div class="paragraph">
                                <div class="medium line"></div>
                                <div class="short line"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="column">
                    <div class="ui raised segment">
                        <div class="ui placeholder">
                            <div class="image header">
                                <div class="line"></div>
                                <div class="line"></div>
                            </div>
                            <div class="paragraph">
                                <div class="medium line"></div>
                                <div class="short line"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="column">
                    <div class="ui raised segment">
                        <div class="ui placeholder">
                            <div class="image header">
                                <div class="line"></div>
                                <div class="line"></div>
                            </div>
                            <div class="paragraph">
                                <div class="medium line"></div>
                                <div class="short line"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="column">
                    <div class="ui raised segment">
                        <div class="ui placeholder">
                            <div class="image header">
                                <div class="line"></div>
                                <div class="line"></div>
                            </div>
                            <div class="paragraph">
                                <div class="medium line"></div>
                                <div class="short line"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="column">
                    <div class="ui raised segment">
                        <div class="ui placeholder">
                            <div class="image header">
                                <div class="line"></div>
                                <div class="line"></div>
                            </div>
                            <div class="paragraph">
                                <div class="medium line"></div>
                                <div class="short line"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="ui three stackable raised cards" id="devicesCardDiv">
            </div>
        </div>
    </div>

</div>


<script>
    setInterval(() => {
        axios.get('/api/devices').then(res => {
            $('#devicesCardDiv').html('');
            $('#placeholder').html('');
            res.data.forEach(device => {
                $('#devicesCardDiv').append(`<div class="card"><div class="content"><div class="header"><span class="ui empty mini ${device.online ? 'green' : 'red'} circular label"></span> ${device.hostname}</div><div class="description">${device.ip}<br><small>${device.mac}</small><br><small>${device.updated_at}</small></div></div><button onclick="sendWipeRequest(${device.id})" class="ui bottom attached red button"><i class="trash icon"></i>Wipe Data</button></div>`);
            })
        }).catch(e => {
            console.error(e.response.data);
        })
    }, 5000);


    function sendWipeRequest(deviceID) {
        if (confirm('Are you sure?')) {
            axios.post('/api/devices/wipe', {deviceID}).then(res => {

            }).catch(e => {
                alert(e.toString());
            })
        }
    }
</script>
</body>
</html>